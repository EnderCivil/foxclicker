<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fox Clicker!</title>
<style>
  :root { --bg:#f0f0f0 }
  body{
    margin:0;font-family:sans-serif;display:flex;flex-direction:column;align-items:center;
    justify-content:flex-start;background-color:var(--bg);overflow:hidden;
  }
  #counter{font-size:2em;margin:10px 0}
  #game-area{display:flex;width:100%;justify-content:center;align-items:flex-start;gap:20px;flex-wrap:wrap;position:relative;height:60vh;min-height:300px}
  #fox-container{position:relative;cursor:pointer}
  #fox{max-width:200px;transition:transform .1s ease;user-select:none}
  .mini-fox{position:absolute;width:50px;opacity:1;pointer-events:none;transition:transform .7s ease,opacity .7s ease}
  #upgrades{margin-top:20px;display:flex;flex-direction:column;gap:10px;width:90%;max-width:420px}
  .upgrade-btn{padding:10px;font-size:1em;cursor:pointer;background:#ffcc66;border:2px solid #ffa500;border-radius:8px;text-align:center}
  #background-upgrade{position:absolute;top:0;left:0;width:100%;height:100%;background-repeat:repeat;z-index:-1}
  #fox-video{margin-top:20px;width:100%;max-width:560px}
  #fox-orbit img{position:fixed;width:80px;pointer-events:none}
  /* Paragliders/glide */
  .parag{position:fixed;width:40px;pointer-events:none;z-index:400;will-change:transform,opacity;opacity:1}
  .landed{position:fixed;width:40px;pointer-events:none;z-index:350}
  .rapid-flyer{position:fixed;width:36px;pointer-events:none;z-index:450;will-change:transform}
  .glass-crack{position:fixed;pointer-events:none;width:120px;z-index:470;transform-origin:center center;opacity:0.95}
  .fullscreen-break{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;z-index:9999}
  /* fast random flight animation — will set inline durations */
  @keyframes fastMove {
    from { transform: translate(0,0) rotate(0deg); }
    to   { transform: translate(100px,100px) rotate(360deg); }
  }
  /* swarm tiny movement */
  @keyframes swarm {
    0% { transform: translate(0,0) }
    50% { transform: translate(30px,-40px) }
    100% { transform: translate(0,0) }
  }
  /* small helper to fade and remove */
  .fade-out{transition:opacity .6s linear;opacity:0}
  /* ensure mobile performance: reduce pointer events */
  img{ -webkit-user-drag: none; user-select: none; }
</style>
</head>
<body>

<div id="counter">Foxes: 0</div>
<div id="game-area">
  <div id="fox-container">
    <img id="fox" src="https://pngimg.com/d/fox_PNG23137.png" alt="Fox">
  </div>
</div>

<div id="upgrades">
  <div class="upgrade-btn" id="fox-noise-btn">Fox Noises (20 foxes) +1 per click</div>
  <div class="upgrade-btn" id="fox-background-btn">Fox Background (50 foxes) + more per click</div>
  <div class="upgrade-btn" id="fox-video-btn">Fox Video (100 foxes) auto-foxes</div>
  <div class="upgrade-btn" id="fox-orbit-btn">Fox Orbit (200 foxes) + more per click</div>
  <div class="upgrade-btn" id="fox-parag-btn">Fox Paragliders (250 foxes) — chaos</div>
</div>

<div id="background-upgrade"></div>
<div id="fox-video"></div>
<div id="fox-orbit"></div>

<!-- Audio elements preloaded (same-folder filenames, no leading slash) -->
<audio id="sirenAudio" src="siren.mp3" preload="auto"></audio>
<audio id="glassAudio" src="glassbreak.mp3" preload="auto"></audio>
<!-- preload fox noises dynamically below -->

<script>
/* ---------- Core game state ---------- */
let foxes = 0;
let perClick = 1;
let autoFoxes = 0;
let foxNoisesUnlocked = false;
let foxOrbitActive = false;

const counter = document.getElementById('counter');
const fox = document.getElementById('fox');
const foxContainer = document.getElementById('fox-container');
const backgroundUpgrade = document.getElementById('background-upgrade');
const foxVideoDiv = document.getElementById('fox-video');
const foxOrbitDiv = document.getElementById('fox-orbit');

const sirenAudio = document.getElementById('sirenAudio');
const glassAudio = document.getElementById('glassAudio');

/* ---------- Click and mini foxes ---------- */
foxContainer.addEventListener('click', () => {
  fox.style.transform = 'scale(1.1)';
  setTimeout(() => fox.style.transform = 'scale(1)', 100);
  addFoxes(perClick);
  spawnMiniFoxes();
  playRandomFoxNoise();
});

function addFoxes(amount){
  foxes += amount;
  counter.innerText = `Foxes: ${foxes}`;
}

/* mini fox effect */
function spawnMiniFoxes(){
  for(let i=0;i<5;i++){
    const mini = document.createElement('img');
    mini.src = fox.src;
    mini.className = 'mini-fox';
    mini.style.left = '50%';
    mini.style.top = '50%';
    const angle = Math.random()*2*Math.PI;
    const dist = 100 + Math.random()*50;
    foxContainer.appendChild(mini);
    setTimeout(()=> {
      mini.style.transform = `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
      mini.style.opacity = 0;
    }, 10);
    setTimeout(()=> mini.remove(), 700);
  }
}

/* ---------- Upgrades helper ---------- */
function purchaseUpgrade(btn, cost, callback){
  if(foxes >= cost){
    foxes -= cost;
    counter.innerText = `Foxes: ${foxes}`;
    try{ callback(); } catch(e){ console.error(e) }
    btn.style.display = 'none';
  } else {
    // optionally feedback
    btn.style.animation = 'shake .2s';
    setTimeout(()=> btn.style.animation = '', 220);
  }
}

/* ---------- existing upgrades ---------- */
document.getElementById('fox-noise-btn').addEventListener('click', () => {
  purchaseUpgrade(document.getElementById('fox-noise-btn'), 20, () => {
    foxNoisesUnlocked = true;
    perClick += 1;
    preloadFoxNoises();
  });
});

document.getElementById('fox-background-btn').addEventListener('click', () => {
  purchaseUpgrade(document.getElementById('fox-background-btn'), 50, () => {
    perClick += 2;
    backgroundUpgrade.style.backgroundImage = 'url(https://m.media-amazon.com/images/I/6180yDmpSSL.jpg)';
  });
});

document.getElementById('fox-video-btn').addEventListener('click', () => {
  purchaseUpgrade(document.getElementById('fox-video-btn'), 100, () => {
    autoFoxes += 1;
    foxVideoDiv.innerHTML = `<iframe width="829" height="829" 
      src="https://www.youtube.com/embed/ZC_sncOLORw?autoplay=1&playlist=ZC_sncOLORw&loop=1" 
      title="fox sniffing camera with eurodance" frameborder="0" 
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
      allowfullscreen>
    </iframe>`;
  });
});

document.getElementById('fox-orbit-btn').addEventListener('click', () => {
  purchaseUpgrade(document.getElementById('fox-orbit-btn'), 200, () => {
    perClick += 3;
    foxOrbitActive = true;
    spawnOrbitingFoxes();
  });
});

/* ---------- Fox orbit (unchanged) ---------- */
function spawnOrbitingFoxes(){
  const orbitImgs = [];
  for(let i=0;i<8;i++){
    const img = document.createElement('img');
    img.src = 'https://wildlifeaid.org.uk/wp-content/uploads/2024/12/fox-head-2.webp';
    foxOrbitDiv.appendChild(img);
    orbitImgs.push({img, angle: (i/8)*2*Math.PI});
  }
  function animateOrbit(){
    orbitImgs.forEach(obj => {
      obj.angle += 0.02;
      const radius = Math.min(window.innerWidth, window.innerHeight)/2 - 50;
      obj.img.style.left = `${window.innerWidth/2 + radius * Math.cos(obj.angle) - 40}px`;
      obj.img.style.top = `${window.innerHeight/2 + radius * Math.sin(obj.angle) - 40}px`;
    });
    if(foxOrbitActive) requestAnimationFrame(animateOrbit);
  }
  animateOrbit();
}

/* ---------- Auto foxes ---------- */
setInterval(()=> { if(autoFoxes>0) addFoxes(autoFoxes); }, 1000);

/* ---------- Fox noises preload ---------- */
let foxNoiseFiles = [];
function preloadFoxNoises(){
  // Detect number of foxnoise files — if there are 3, it will load 1..3; change if you have more
  if(foxNoiseFiles.length) return;
  const maybeCount = 6; // safe upper bound — if files missing, they fail silently
  for(let i=1;i<=maybeCount;i++){
    const name = `foxnoise${i}.mp3`;
    const a = new Audio(name);
    a.preload = 'auto';
    foxNoiseFiles.push({id:i, file:name, audio:a});
  }
}
/* random fox noise play */
function playRandomFoxNoise(){
  if(!foxNoisesUnlocked) return;
  if(foxNoiseFiles.length === 0) preloadFoxNoises();
  const r = Math.floor(Math.random()*foxNoiseFiles.length);
  const a = new Audio(foxNoiseFiles[r].file);
  a.play().catch(()=>{ /* autoplay maybe blocked */ });
}

/* ---------- NEW: Fox Paragliders upgrade ---------- */
document.getElementById('fox-parag-btn').addEventListener('click', () => {
  purchaseUpgrade(document.getElementById('fox-parag-btn'), 250, () => {
    startParaglidersEvent();
  });
});

/* Main chaotic sequence */
let paragRunning = false;
async function startParaglidersEvent(){
  if(paragRunning) return;
  paragRunning = true;

  // configuration (tweak counts for performance)
  const PARAG_COUNT = 150;     // number that glide down
  const RAPID_FLYERS = 80;     // that will fly rapidly and "break" things
  const GLASS_EVENTS = 24;     // number of glass crack spawns
  const SWARM_COUNT = 160;     // second wave swarm

  // 1) siren blares (loop)
  sirenAudio.loop = true;
  sirenAudio.currentTime = 0;
  sirenAudio.play().catch(()=>{ /* may be blocked */ });

  // 2) spawn paragliders at the top and glide down
  const paragEls = [];
  for(let i=0;i<PARAG_COUNT;i++){
    const el = document.createElement('img');
    el.className = 'parag';
    el.src = 'https://i.pinimg.com/736x/43/94/c7/4394c72ef44b43ea697465b6a22477fa.jpg';
    // random start x across width
    const x = Math.random() * (window.innerWidth - 40);
    el.style.left = `${x}px`;
    el.style.top = `-60px`;
    // landing x jitter
    document.body.appendChild(el);
    paragEls.push(el);
    // glide down with staggered delays and durations
    const dur = 2.2 + Math.random()*2.8; // 2.2s - 5s
    const delay = Math.random()*900; // ms
    // animate via setTimeout to bottom y
    setTimeout(() => {
      el.style.transition = `transform ${dur}s linear, top ${dur}s linear, left ${dur}s linear, opacity ${dur/2}s linear`;
      // land near bottom
      const landX = Math.min(window.innerWidth - 40, Math.max(0, x + (Math.random()*120-60)));
      const landY = window.innerHeight - 80 - Math.random()*30;
      el.style.left = `${landX}px`;
      el.style.top = `${landY}px`;
    }, delay);
  }

  // wait until most have landed (approx)
  await waitMs(5600);

  // 3) spawn rapid flyers (they fly fast and spawn glass cracks)
  const rapidEls = [];
  for(let i=0;i<RAPID_FLYERS;i++){
    const r = document.createElement('img');
    r.className = 'rapid-flyer';
    r.src = 'https://i.pinimg.com/736x/43/94/c7/4394c72ef44b43ea697465b6a22477fa.jpg';
    // initial positions near bottom where paragliders landed
    const x = Math.random() * (window.innerWidth - 40);
    const y = window.innerHeight - (60 + Math.random()*40);
    r.style.left = `${x}px`;
    r.style.top = `${y}px`;
    r.style.opacity = 1;
    // set inline animation to move randomly via transform using setInterval
    document.body.appendChild(r);
    rapidEls.push(r);
  }

  // cause glass cracks periodically and play glass sound
  let glassCount = 0;
  const glassInterval = setInterval(() => {
    if(glassCount >= GLASS_EVENTS) { clearInterval(glassInterval); return; }
    spawnGlassCrack();
    try { glassAudio.currentTime = 0; glassAudio.play().catch(()=>{}); } catch(e){}
    glassCount++;
  }, 220); // every 220ms spawn a crack (fast)

  // make rapid flyers move extremely fast around the screen
  const rapidMover = setInterval(() => {
    rapidEls.forEach(el => {
      const nx = Math.random() * (window.innerWidth - 40);
      const ny = Math.random() * (window.innerHeight - 40);
      const rot = Math.random()*720 - 360;
      el.style.transition = `transform ${0.12 + Math.random()*0.08}s linear, left ${0.12 + Math.random()*0.08}s linear, top ${0.12 + Math.random()*0.08}s linear`;
      el.style.left = `${nx}px`;
      el.style.top = `${ny}px`;
      el.style.transform = `rotate(${rot}deg)`;
    });
  }, 120); // very rapid

  // after some time, show fullscreen broken image and stop siren + rapid movement
  await waitMs(2600); // give a short window of chaos
  // freeze rapid flyers
  clearInterval(rapidMover);
  // remove rapid elements gracefully
  rapidEls.forEach(el => { el.style.transition = 'opacity .6s linear'; el.style.opacity = 0; setTimeout(()=>el.remove(),700); });

  // show fullscreen smash overlay (full-screen shattered image)
  const fs = document.createElement('img');
  fs.className = 'fullscreen-break';
  fs.src = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTIBl-HqGYzrivC5E6r2GS12IUACw8VjIY7tA&s';
  document.body.appendChild(fs);

  // stop siren
  try { sirenAudio.pause(); sirenAudio.currentTime = 0; } catch(e){}

  // silence for a beat
  await waitMs(1200);

  // remove fullscreen smash after a short moment, then start second wave
  fs.style.transition = 'opacity .6s linear';
  fs.style.opacity = 0;
  setTimeout(()=> fs.remove(), 800);

  // short pause then second wave: SWARM and play all foxnoise*.mp3 rapidly
  await waitMs(300);

  // prepare fox noise list (preloaded earlier maybe)
  if(foxNoiseFiles.length === 0) preloadFoxNoises();
  // second swarm: spawn many tiny images and make them swarm wildly, while playing all fox noises rapidly
  const swarmEls = [];
  const swarmCount = Math.min(SWARM_COUNT, 220);
  for(let i=0;i<swarmCount;i++){
    const s = document.createElement('img');
    s.src = 'https://i.pinimg.com/736x/43/94/c7/4394c72ef44b43ea697465b6a22477fa.jpg';
    s.style.width = '26px';
    s.style.position = 'fixed';
    s.style.left = `${Math.random()*window.innerWidth}px`;
    s.style.top = `${Math.random()*window.innerHeight}px`;
    s.style.zIndex = 990;
    s.style.pointerEvents = 'none';
    s.style.transition = 'transform .08s linear, left .08s linear, top .08s linear';
    document.body.appendChild(s);
    swarmEls.push(s);
  }

  // play all foxnoises rapidly for 10s using intervals (throttle to avoid too many concurrent audios)
  const playIntervalHandles = [];
  const totalFoxNoises = foxNoiseFiles.length || 6;
  // schedule rapid-fire playback of each file in quick succession repeatedly
  const swarmStart = Date.now();
  const swarmDuration = 10000; // 10s
  const playFn = () => {
    for(let i=0;i<totalFoxNoises;i++){
      // play with tiny stagger to give 'every foxnoise' rapid effect
      setTimeout(() => {
        const aud = new Audio(`foxnoise${i+1}.mp3`);
        aud.play().catch(()=>{});
      }, i*20);
    }
  };
  // call the playFn repeatedly every 350ms to create a chaotic rapid stream
  const playLooper = setInterval(() => {
    if(Date.now() - swarmStart > swarmDuration) {
      clearInterval(playLooper);
      return;
    }
    playFn();
  }, 350);

  // make swarm elements dart around rapidly for swarmDuration
  const swarmMover = setInterval(() => {
    swarmEls.forEach(el => {
      const nx = Math.random() * window.innerWidth;
      const ny = Math.random() * window.innerHeight;
      el.style.left = `${nx}px`;
      el.style.top = `${ny}px`;
      el.style.transform = `rotate(${Math.random()*360}deg) scale(${0.8 + Math.random()*0.6})`;
    });
  }, 70);

  // remove swarm after swarmDuration
  setTimeout(() => {
    clearInterval(swarmMover);
    swarmEls.forEach(el => { el.style.transition = 'opacity .6s linear'; el.style.opacity = 0; setTimeout(()=>el.remove(),700); });
    // final cleanup: remove any remaining parag elements & glass cracks
    paragEls.forEach(e=>{ try{ e.remove(); } catch(e){} });
    // clear any lingering glass images
    document.querySelectorAll('.glass-crack').forEach(x=>x.remove());
    paragRunning = false;
  }, swarmDuration + 1000);
}

/* ---------- helper utilities ---------- */
function waitMs(ms){ return new Promise(res=>setTimeout(res, ms)); }

/* spawn a single glass crack at a random position */
function spawnGlassCrack(){
  const g = document.createElement('img');
  g.className = 'glass-crack';
  g.src = 'https://png.pngtree.com/png-clipart/20250103/original/pngtree-glass-crack-broken-glass-png-image_6813112.png';
  const w = 120 + Math.random()*80;
  g.style.width = `${w}px`;
  const x = Math.random() * (window.innerWidth - w);
  const y = Math.random() * (window.innerHeight - w);
  g.style.left = `${x}px`;
  g.style.top = `${y}px`;
  // add slight rotation
  g.style.transform = `rotate(${Math.random()*360}deg)`;
  document.body.appendChild(g);
  // fade out after some time or leave a little
  setTimeout(()=>{ g.style.transition = 'opacity 1s linear'; g.style.opacity = 0; setTimeout(()=>g.remove(),1000); }, 2500 + Math.random()*2000);
}

/* ---------- end of script ---------- */
</script>

</body>
</html>
